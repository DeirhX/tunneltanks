#include <drawbuffer.h>
#include <memalloc.h>
#include <memory>

/* Various colors for use in the game: */
Color color_dirt_hi       = Color(0xc3, 0x79, 0x30);
Color color_dirt_lo       = Color(0xba, 0x59, 0x04);
Color color_rock          = Color(0x9a, 0x9a, 0x9a);
Color color_fire_hot      = Color(0xff, 0x34, 0x08);
Color color_fire_cold     = Color(0xba, 0x00, 0x00);
Color color_blank         = Color(0x00, 0x00, 0x00);
Color color_bg            = Color(0x00, 0x00, 0x00);
Color color_bg_dot        = Color(0x00, 0x00, 0xb6);
Color color_status_bg     = Color(0x65, 0x65, 0x65);
Color color_status_energy = Color(0xf5, 0xeb, 0x1a);
Color color_status_health = Color(0x26, 0xf4, 0xf2);

/* Primary colors: */
Color color_primary[8] = {
	Color(0x00, 0x00, 0x00),
	Color(0xff, 0x00, 0x00),
	Color(0x00, 0xff, 0x00),
	Color(0xff, 0xff, 0x00),
	Color(0x00, 0x00, 0xff),
	Color(0xff, 0x00, 0xff),
	Color(0x00, 0xff, 0xff),
	Color(0xff, 0xff, 0xff)
};

Color color_tank[8][3] = {
	/* Blue tank: */
	{ Color(0x2c,0x2c,0xff), Color(0x00,0x00,0xb6), Color(0xf3,0xeb,0x1c) },
	
	/* Green tank: */
	{ Color(0x00,0xff,0x00), Color(0x00,0xaa,0x00), Color(0xf3,0xeb,0x1c) },
	
	/* Red tank: */
	{ Color(0xff,0x00,0x00), Color(0xaa,0x00,0x00), Color(0xf3,0xeb,0x1c) },
	
	/* Pink tank: */
	{ Color(0xff,0x99,0x99), Color(0xaa,0x44,0x44), Color(0xf3,0xeb,0x1c) },
	
	/* Purple tank: */
	{ Color(0xff,0x00,0xff), Color(0xaa,0x00,0xaa), Color(0xf3,0xeb,0x1c) },
	
	/* White tank: */
	{ Color(0xee,0xee,0xee), Color(0x99,0x99,0x99), Color(0xf3,0xeb,0x1c) },
	
	/* Aqua tank: */
	{ Color(0x00,0xff,0xff), Color(0x00,0xaa,0xaa), Color(0xf3,0xeb,0x1c) },
	
	/* Gray tank: */
	{ Color(0x66,0x66,0x66), Color(0x33,0x33,0x33), Color(0xf3,0xeb,0x1c) }
};


/* TODO: We're using color structures here because we started with Uint32 values
 *       and this was an easier transition. Eventually, all colors will be in a
 *       central array, and the pixel data will simply be 1-byte indexes. */


DrawBuffer::DrawBuffer(Size size): size(size), default_color(0, 0, 0)
{
	pixel_data.reset(new Color[size.x * size.y]);
}

void DrawBuffer::SetPixel(Position offset, Color color)
{
	if (offset.x < 0 || offset.y < 0 || offset.x >= size.x || offset.y >= size.y) return;
	pixel_data.get()[offset.y * size.x + offset.x] = color;
}

Color DrawBuffer::GetPixel(Position offset)
{
	if (offset.x < 0 || offset.y < 0 || offset.x >= size.x || offset.y >= size.y) return this->default_color;
	return pixel_data.get()[offset.y * size.x + offset.x];
}
